<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>

    <ion-item lines="none" class="search-item">
      <ion-icon name="search-outline" slot="start"></ion-icon>
      <ion-input
        placeholder="Pesquisar..."
        [(ngModel)]="searchProductsQuery"
        (keyup.enter)="searchProducts()"
        clearInput="true"
      ></ion-input>
    </ion-item>
    
    <ion-buttons slot="end">
      <ion-button routerLink="/little-car">
        <ion-icon slot="icon-only" name="cart-outline"></ion-icon>
        <ion-badge color="danger" *ngIf="qtdCarrinho > 0">{{ qtdCarrinho }}</ion-badge>
      </ion-button>
      <ion-button [routerLink]="isLoggedIn ? '/profile' : '/login-user'">
        <ion-icon slot="icon-only" name="person-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-card *ngIf="product">
    <swiper-container [loop]="true" [pagination]="true" [autoplay]="{ delay: 4000 }">
      <swiper-slide *ngFor="let image of product?.images">
        <img [src]="image" />
      </swiper-slide>
    </swiper-container>

    <ion-card-content>
      <div class="product-info-details">
        <div class="product-info-stars">
          <div class="stars">
            <ion-icon *ngFor="let star of estrelas" [name]="star"></ion-icon>
            <ion-text>{{ product?.nota }}</ion-text>
          </div>
        </div>
        <br>
        <p class="name">{{ product?.name }}</p>

        <div class="description-container" [class.expanded]="isExpanded">
          <p class="description">{{ product?.description }}</p>
        </div>
        <ion-button 
          fill="clear" 
          size="small" 
          class="read-more-button" 
          *ngIf="product?.description && product?.description.length > 150"
          (click)="toggleDescription()"
        >
          {{ isExpanded ? 'Ler Menos' : 'Ler Mais' }}
        </ion-button>
        
        <p class="price">R$ {{ product?.price | number:'1.2-2' }}</p>
        <p class="stock-info" *ngIf="(product?.quantity - qtdCarrinho) <= 100">
          <span [ngClass]="{'low-stock': (product?.quantity - qtdCarrinho) <= 10}">
            EM ESTOQUE: {{ product?.quantity - qtdCarrinho }} UNIDADES
          </span>
        </p>
      </div>

      <ion-grid class="quantity-controls">
        <ion-row class="ion-align-items-center">
          <ion-col size="auto">
            <ion-text>Quantidade:</ion-text>
          </ion-col>
          <ion-col class="ion-text-center">
            <ion-button fill="clear" (click)="diminuirQtd()">
              <ion-icon name="remove-circle-outline"></ion-icon>
            </ion-button>
          </ion-col>
          <ion-col class="ion-text-center">
            <ion-text class="item-quantity">{{ qtd }}</ion-text>
          </ion-col>
          <ion-col class="ion-text-center">
            <ion-button fill="clear" (click)="aumentarQtd()">
              <ion-icon name="add-circle-outline"></ion-icon>
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-button
      expand="block"
      class="add-to-cart-button"
      (click)="adicionarCarrinho()"
      [disabled]="qtd === 0 || (product?.quantity - qtdCarrinho) === 0"
    >
      <ion-icon slot="start" name="cart-outline"></ion-icon>
      Adicionar ao Carrinho
    </ion-button>
  </ion-toolbar>
</ion-footer>